FROM registry.access.redhat.com/ubi9/ubi
# use rockylinux for testing without a subscription
# FROM docker.io/library/rockylinux:9

RUN dnf --assumeyes update && dnf clean all
RUN dnf --assumeyes install git zip binutils && dnf clean all

# for nuitka
# codeready is already enabled inside ubi
RUN dnf --assumeyes install https://dl.fedoraproject.org/pub/epel/epel-release-latest-9.noarch.rpm && dnf clean all
# RUN dnf install --assumeyes epel-release dnf-plugins-core && dnf config-manager --set-enabled powertools && dnf clean all
RUN dnf --assumeyes install patchelf ccache && dnf clean all

# for compiling selinux policies
RUN dnf --assumeyes install make selinux-policy-devel && dnf clean all

# dependencies for gem / fpm
RUN dnf --assumeyes install ruby-devel gcc make rpm-build libffi-devel && dnf clean all

# install fpm using gem
RUN gem install fpm

RUN python3.9 -m venv --system-site-packages /opt/venv && \
    /opt/venv/bin/python -m pip install pip==24.3.1 wheel==0.45.1 setuptools==50.3.2 && \
    /opt/venv/bin/python -m pip install nuitka==2.5.9
